# 概念

## 目标检测

**全局运动模型** 是一种用于描述场景中整体运动的数学模型。它假设场景中的大部分像素点都在一起运动，通常用来估计背景的整体运动趋势。常见的全局运动模型包括**平移模型**、**仿射变换**、**透视变换**等，它们通过一组参数来描述整个图像或视频帧中大范围的运动，例如镜头移动、缩放、旋转等。

**对齐背景运动参数** 指的是根据全局运动模型估计的参数，将一帧图像中的背景与另一帧中的背景对齐。这是为了消除相机运动或场景中的整体运动对目标物体检测的影响。比如说，如果镜头向右移动，对齐运动参数的操作就是对后续帧进行平移、旋转等处理，使得背景部分看起来保持静止状态，从而能够更容易检测出独立于背景运动的物体。

**将后续帧与背景运动相减** 是背景减法的一部分。背景减法的目的是通过消除背景运动，凸显场景中不随背景一起运动的物体。对齐背景运动后，通过将两帧图像中的背景部分相减（即计算每个像素点的差异），可以得到一个差分图像。在这个差分图像中，背景区域的像素值趋近于零，而运动物体的像素值会明显大于零。这样，运动物体就能够被更容易地检测到。

## 角点检测

**Shi-Tomasi角点检测器** 是一种用于图像特征点提取的算法，属于**角点检测**方法之一。它是基于Harris角点检测器改进而来的，提出者是Jianbo Shi和Carlo Tomasi。其主要作用是从图像中找到局部显著的角点（特征点），这些角点可以用于后续的计算机视觉任务，比如**图像配准**、**物体跟踪**、**三维重建**等。

### Shi-Tomasi角点检测器的原理：
角点是图像中特别具有辨识度的点，通常存在于图像中曲率变化较大的位置（如物体的边缘、交点等）。Shi-Tomasi算法通过计算每个像素点的响应值来判断是否为角点，这个响应值反映了该点周围的亮度变化程度。具体来说，算法会计算每个像素的局部二阶矩矩阵（也称为结构张量），然后取该矩阵的最小特征值。如果最小特征值大于某个阈值，表明该像素点具有角点性质。

与Harris角点检测器不同的是，Shi-Tomasi检测器直接使用了最小特征值来判断角点，而不是使用Harris角点检测器中的响应函数。这一改进提高了角点检测的准确性。

### 主要用途：
1. **图像特征提取**：在图像中检测出稳定、易于跟踪的特征点。
2. **物体跟踪**：在视频序列中追踪这些特征点，尤其在像无人机跟踪、物体检测中非常有用。
3. **图像拼接**：通过角点匹配，进行多张图像的拼接，应用于全景图生成。
4. **三维重建**：角点可以帮助在不同视角下匹配相同的物体，从而辅助三维重建。

由于Shi-Tomasi角点检测器在检测稳定角点方面表现良好，它经常被用于需要精确特征提取的视觉任务中。

## 光流向量

**Lucas-Kanade方法** 是一种用于估计光流的经典方法，特别适用于视频或图像序列中相邻帧之间的运动估计。Lucas-Kanade方法的核心思想是利用局部图像区域的亮度一致性假设来计算光流，即在小区域内，像素的亮度随时间变化是很小的。通过这种假设，Lucas-Kanade方法能够估计图像中物体或像素的运动方向和速度。

### Lucas-Kanade方法的基本原理：
Lucas-Kanade方法依赖以下假设：
1. **亮度恒常性假设**：在相邻帧之间，图像中的像素值（亮度）基本保持不变。
2. **局部一致性假设**：在一个小的图像窗口中，相邻像素的运动一致或变化较小。

基于这些假设，我们可以使用泰勒展开式近似帧之间像素的亮度变化，然后通过求解线性方程组来计算像素的运动向量（光流）。

### 求解最小二乘问题：
由于每个像素的光流向量只有两个未知量（水平速度和垂直速度），而每个窗口中的像素提供了多个方程，这通常构成了一个**超定方程组**（方程数量多于未知量）。为了解决这个问题，Lucas-Kanade方法通过**最小二乘法**来求解光流，即找到一组光流向量，使得局部窗口内所有像素的亮度变化误差最小化。

具体来说，对于每个小窗口，Lucas-Kanade方法尝试最小化以下形式的误差：
$$
E = \sum_{i \in W} (I(x_i + u, y_i + v, t+1) - I(x_i, y_i, t))^2
$$

其中：
- $I(x_i, y_i, t)$ 表示在时间 \( t \) 时刻图像中的像素值，
- $u$ 和 $v$ 是光流的水平和垂直分量，
- $W$是局部窗口中的像素点。

通过求解该最小化问题，Lucas-Kanade方法得出该窗口内像素的光流向量。

### 亚像素精度：
光流的估计通常是基于整数像素位置的变化，但是实际场景中的物体运动可能并不完全匹配整数像素。因此，为了提高精度，可以通过插值等技术将光流矢量估计到**亚像素精度**，即允许光流的水平和垂直分量不是整数，而是更精确的浮点数，从而更精确地描述物体的运动。

## 卡尔曼跟踪

**卡尔曼追踪**（Kalman tracking）是一种常用的目标跟踪算法，基于**卡尔曼滤波器（Kalman Filter）**，用于在噪声环境下对动态系统的状态进行估计。它能够有效地在不确定性和噪声的条件下预测目标的运动轨迹，因此广泛应用于物体跟踪、导航、信号处理等领域。

### 基本原理：
卡尔曼追踪通过两个主要步骤来工作：
1. **预测（Prediction）**：根据当前状态和模型，预测目标的下一个状态。通常使用目标的运动模型（如匀速或匀加速模型）来预测下一时刻的位置信息。
2. **更新（Update）**：在新观测值（如传感器或图像中的检测结果）到来后，结合预测和观测结果，使用卡尔曼滤波器来更新状态估计，减少误差。

### 主要概念：
- **状态向量（State Vector）**：描述目标的当前状态，比如位置、速度、加速度等。典型的状态向量可能包括目标的 \( x \) 和 \( y \) 坐标、速度 \( v_x \) 和 \( v_y \)。
- **预测模型（Motion Model）**：目标的运动模型，通常假设为线性系统，目标可能按照匀速或匀加速运动。
- **观测（Measurement）**：来自外界的测量值，比如摄像机检测到的目标位置或传感器提供的数据。这些观测值通常包含噪声。
- **误差协方差矩阵（Error Covariance Matrix）**：跟踪系统对状态估计的不确定性，表示系统当前对目标状态的信任度。

### 卡尔曼滤波的工作流程：
1. **初始化**：首先定义目标的初始状态（位置、速度等），并初始化误差协方差矩阵。
2. **预测步骤**：
   - 根据目标的运动模型（如匀速运动模型），计算出下一时刻的预测状态（如位置、速度）和预测误差。
   - 这一步基于物理模型，假设目标会以特定的运动方式移动。
3. **更新步骤**：
   - 通过传感器或检测器，获取目标在当前时刻的观测值。
   - 结合预测值与观测值，用卡尔曼增益调整预测结果，得到更精确的估计。
   - 同时更新误差协方差矩阵。

### 卡尔曼追踪的优势：
- **处理噪声数据**：卡尔曼滤波器通过数学模型将观测数据和预测模型结合，可以处理不确定性和噪声干扰，使得跟踪更加平稳。
- **动态预测**：即使在目标短时间内不可见或观测数据缺失的情况下，卡尔曼滤波器也能通过预测模型继续进行跟踪，并在目标重新出现时校正其位置。
- **实时性好**：卡尔曼滤波器的计算效率较高，适用于实时跟踪任务。

### 卡尔曼追踪的不足：
- **线性假设**：标准的卡尔曼滤波器假设系统是线性的，适合于线性运动模型。如果目标做非线性运动，卡尔曼追踪可能表现不佳。这时可以使用扩展卡尔曼滤波器（EKF）或无迹卡尔曼滤波器（UKF）等改进算法。
- **对模型的依赖**：卡尔曼滤波器依赖于目标运动的物理模型，如果模型与真实运动模式差别较大，跟踪效果会下降。

### 应用场景：
- **视频目标跟踪**：在视频流中跟踪移动的物体（如行人、车辆等），卡尔曼追踪可以帮助平滑物体的运动轨迹，消除短暂的检测误差。
- **无人机/机器人导航**：卡尔曼追踪用于推测和估计无人机或机器人的位置和速度，帮助它们在复杂环境中定位和导航。
- **信号处理**：在雷达、声纳等系统中，卡尔曼滤波器用于跟踪物体的位置和速度。

### 公式示例：
卡尔曼滤波器的数学描述通常包括以下几个公式：
1. **预测状态**：
   $$
   \hat{x}_{k|k-1} = A \hat{x}_{k-1|k-1} + B u_k
   $$
   其中，$\hat{x}_{k|k-1}$ 是预测的状态，$A$ 是状态转移矩阵，$B$ 是控制矩阵，$u_k$ 是控制输入。
   
2. **预测误差协方差**：
$$
   P_{k|k-1} = A P_{k-1|k-1} A^T + Q
   $$
   其中，$P_{k|k-1}$ 是预测的误差协方差矩阵，$Q$是过程噪声协方差。

3. **卡尔曼增益**：
   $$
   K_k = P_{k|k-1} H^T (H P_{k|k-1} H^T + R)^{-1}
   $$
   其中，$K_k$ 是卡尔曼增益，$H$是观测矩阵，$R$ 是观测噪声协方差。

4. **更新状态**：
   $$
   \hat{x}_{k|k} = \hat{x}_{k|k-1} + K_k (z_k - H \hat{x}_{k|k-1})
   $$
   其中，$z_k$是当前的观测值。

5. **更新误差协方差**：
   $$
   P_{k|k} = (I - K_k H) P_{k|k-1}
   $$

这些公式描述了卡尔曼滤波的工作原理，包括预测和更新的两个主要步骤。
